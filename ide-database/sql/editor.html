<!doctype html>
<html>
	<head>
		<!-- jQuery -->
	<script src="/services/v3/web/resources/jquery/2.0.3/jquery.min.js"></script>
	
	<!-- Twitter Bootstrap with Theme Support -->
	<link rel="stylesheet" href="/services/v3/core/theme/bootstrap.min.css">
	<script src="/services/v3/web/resources/bootstrap/3.3.7/bootstrap.min.js"></script>
	
		<script src="lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
		<script src="lib/ace/ext-language_tools.js" type="text/javascript"></script>
		<style type="text/css" media="screen">
		  body {
		      overflow: hidden;
		  }

		  #editor {
		      margin: 0;
		      position: absolute;
		      top: 0;
		      bottom: 0;
		      left: 0;
		      right: 0;
		  }

		</style>
		
	<link rel="stylesheet" href="/services/v3/core/theme/ace.css">
		
	</head>
	<body style="height: 100%;">
 		<pre id="editor" class="ace-ambiance"></pre>
		
		<script type="text/javascript">
			
			var processChangeEvents = true;
			var editor = ace.edit("editor");
			var aceRange = ace.require('ace/range').Range;
			var beforeSaveText = "";
			
		    editor.setOptions({
		        enableBasicAutocompletion: true,
		        enableSnippets: true,
		        enableLiveAutocompletion: true
		    });

			//commands
			editor.commands.addCommand({
				name: 'execute',
				bindKey: {
					win: 'Ctrl-X',
					mac: 'Command-X'
				},
				exec: function(e) {
					beforeSaveText = e.getSession().getValue();
					executeCalled();
				},
				readOnly: true // false if this command should not apply in readOnly mode
			});

			function setMode(mode) {
				editor.getSession().setMode("ace/mode/" + mode);
			}

			function setText(text, mode, readOnlyStatus, breakpointsenabledStatus, row) {
				beforeSaveText = text;
				setTimeout(function() {
					editor.getSession().setMode("ace/mode/" + mode);
					editor.getSession().getUndoManager().reset();
					setReadOnly(readOnlyStatus);
					editor.gotoLine(row, 0, true);
					editor.getSession().setValue(text);
				}, 500);
			}

			function getText() {
				return editor.getValue();
			}

			function setReadOnly(status) {
				if (!status) {
					editor.getSession().clearBreakpoints();
				}
				editor.setReadOnly(status);
			}
			
			function executeCalled() {
				$.post( "/services/v3/ide/databases/derby/DefaultDB/query", beforeSaveText, function( data ) {
  					alert(JSON.stringify(data));
				});
			}
			
			setText("-- ctrl+x to execute\n", "sql", false, false, 2);

			
		</script>
	</body>
</html>